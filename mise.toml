[tools]

[tasks.install_tools]
description = "mise install"
run = "mise install"

[tasks.install_tpm]
description = "Install Tmux Plugin Manager"
depends = ["install_tools"]
run = """
#!/bin/bash
TPM_DIR="$HOME/.tmux/plugins/tpm"

if [ -d "$TPM_DIR" ]; then
    echo "âœ… TPM already exists, skip..."
else
    echo "â¬‡ï¸ Cloning TPM..."
    git clone https://github.com/tmux-plugins/tpm "$TPM_DIR"
    "$TPM_DIR/bin/install_plugins"
fi
"""

[tasks.install_oh_my_zsh]
description = "Install Oh My Zsh"
depends = ["install_zsh"]
outputs = ["~/.oh-my-zsh/oh-my-zsh.sh"]
run = """
#!/bin/bash
if [ ! -d "$HOME/.oh-my-zsh" ]; then
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
fi

git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k
"""

[tasks.change_shell]
description = "change default shell to zsh"
depends = ["install_oh_my_zsh"]
run = """
#!/bin/bash
if [ "$SHELL" != "$(which zsh)" ]; then
    echo "ðŸ”„ æ­£åœ¨åˆ‡æ¢ Shell åˆ° Zsh (éœ€è¦å¯†ç )..."
    chsh -s "$(which zsh)"
fi
"""

[tasks.update_tpm]
description = "Update TPM"
run = """
#!/bin/bash
cd "$HOME/.tmux/plugins/tpm" && git pull
"""

[tasks.nvim_plugins]
description = "Install Vim Plug"
depends = ["install_tools"]
run = """
#!/bin/bash
sh -c 'curl -fLo "${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/autoload/plug.vim --create-dirs \
       https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'


nvim --headless +PlugInstall +qall

"""

[tasks.setup]
description = "Install tools and link dotfiles"
depends = ["install_tools", "install_oh_my_zsh", "change_shell"]
run = """
#!/bin/bash

if [[ "$OSTYPE" == "darwin"* ]]; then
    echo "ðŸŽ On macOS, Running Homebrew..."
    brew bundle --file=$(pwd)/Brewfile
elif [[ "$OS" == "Windows_NT" ]]; then
    echo "ðŸªŸ On Windowsï¼Œchoco install.." 
else
    echo "ðŸ§ On Linux"
fi
SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )
$SCRIPT_DIR/scripts/link.sh
"""
